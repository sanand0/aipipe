# Known Bugs

This document lists bugs discovered during code review. Items with a linked test
case are validated by failing unit tests.

- **Query parameters lost after login** (`public/aipipe.js`)
  - `URLSearchParams.length` is used instead of `.size`, causing all remaining
    query parameters to be stripped from the URL when `getProfile()` runs.
  - Tested in `test/bugs.test.js`.
- **Duplicate embeddings requests** (`src/providers.js`)
  - When calling `/similarity` without providing `topics`, the code duplicates the
    document list which doubles token usage and cost.
  - Tested in `test/bugs.test.js`.
- **Open redirect in login page** (`public/login.js`)
  - The `redirect` parameter is converted with `new URL(redirect,
    window.location.origin)` and then used for `window.location.href` without
    verifying that it remains on the same origin. Tokens could be leaked to an
    attacker. (No automated test.)
- **Tokens have no expiry** (`src/utils.js` & `src/worker.js`)
  - JWT tokens generated by `createToken` and by the login flow are valid
    indefinitely. There is no expiry claim or rotation mechanism.
  - No automated test.
